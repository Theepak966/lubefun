<div class="header">
    <!-- Left: Logo -->
    <a href="/" class="logo flex justify-center items-center">
        <img src="/img/logo.png">
    </a>

    <div class="navigation flex flex-row items-center justify-between">
        <!-- Center: Game Navigation Tabs -->
        <div class="navbar-games flex flex-row items-center justify-center gap-1 flex-1">
            <a href="/crash" class="navbar-game-tab <% if(app.paths[0] == 'crash') { %>active<% } %>">
                <span>Crash</span>
            </a>
            <a href="/coinflip" class="navbar-game-tab <% if(app.paths[0] == 'coinflip') { %>active<% } %>">
                <span>Coinflip</span>
            </a>
            <a href="/blackjack" class="navbar-game-tab <% if(app.paths[0] == 'blackjack') { %>active<% } %>">
                <span>Blackjack</span>
            </a>
            <a href="/mines" class="navbar-game-tab <% if(app.paths[0] == 'mines') { %>active<% } %>">
                <span>Mines</span>
            </a>
            <a href="/tower" class="navbar-game-tab <% if(app.paths[0] == 'tower') { %>active<% } %>">
                <span>Tower</span>
            </a>
            <a href="/" class="navbar-game-tab navbar-game-tab-slots <% if(app.paths.length === 0 || app.paths[0] === '') { %>active<% } %>">
                <span>Slots</span>
            </a>
        </div>

        <!-- Right: Auth / Balance -->
        <div class="navbar-right flex flex-row items-center gap-3">
            <% if(user) { %>
                <!-- Balance Pill with Dropdown -->
                <div class="navbar-balance-wrapper relative">
                    <div class="navbar-balance-pill pointer balances">
                        <% if(page == 'casino' && app.paths.length > 2){ %>
                            <div class="balance flex flex-row items-center justify-center gap-2">
                                <span class="balance-icon">$</span>
                                <span class="amount" style="font-size: 14px; font-weight: 600;">In play</span>
                            </div>
                        <% } else { %>
                            <div class="balance flex flex-row items-center justify-center gap-2" data-type="total">
                                <span class="balance-icon">$</span>
                                <span class="amount">0.00</span>
                                <span class="balance-currency">SOL</span>
                                <i class="fa fa-angle-down balance-arrow" aria-hidden="true"></i>
                            </div>
                            
                            <!-- Dropdown Menu -->
                            <div class="navbar-balance-dropdown list flex flex-col transition duration-200 hidden">
                                <a href="/deposit" class="navbar-dropdown-item">
                                    <span>Deposit</span>
                                </a>
                                <a href="/withdraw" class="navbar-dropdown-item">
                                    <span>Withdraw</span>
                                </a>
                            </div>
                        <% } %>
                    </div>
                </div>

                <!-- User Menu with Dropdown -->
                <div class="navbar-user-wrapper relative">
                    <div class="navbar-user-pill pointer" id="user-menu-toggle">
                        <div class="flex flex-row items-center justify-center gap-2">
                            <img src="<%= user.avatar %>" alt="<%= user.name %>" class="navbar-user-avatar" style="width: 32px; height: 32px; border-radius: 50%; object-fit: cover;">
                            <span class="navbar-user-name" style="font-size: 14px; font-weight: 500;"><%= user.name %></span>
                            <i class="fa fa-angle-down" aria-hidden="true" style="font-size: 12px;"></i>
                        </div>
                        
                        <!-- User Dropdown Menu -->
                        <div class="navbar-user-dropdown list flex flex-col transition duration-200 hidden" id="user-menu-dropdown">
                            <a href="/account/settings" class="navbar-dropdown-item">
                                <i class="fa fa-cog" aria-hidden="true"></i>
                                <span>Settings</span>
                            </a>
                            <a href="/account/security" class="navbar-dropdown-item">
                                <i class="fa fa-shield" aria-hidden="true"></i>
                                <span>Security</span>
                            </a>
                            <a href="/account/games" class="navbar-dropdown-item">
                                <i class="fa fa-history" aria-hidden="true"></i>
                                <span>Games History</span>
                            </a>
                            <div class="navbar-dropdown-divider"></div>
                            <div class="navbar-dropdown-item text-danger pointer" data-modal="show" data-id="#modal_auth_logout">
                                <i class="fa fa-sign-out" aria-hidden="true"></i>
                                <span>Logout</span>
                            </div>
                        </div>
                    </div>
                </div>
            <% } else { %>
                <!-- Sign In Button -->
                <a href="/login?returnUrl=/<%= app.paths.join('/') %>" class="navbar-signin-btn">
                    <span>Sign In</span>
                </a>
            <% } %>
        </div>
    </div>
</div>

<!-- Top Games Navigation Bar - Removed, moved to navbar -->

<div class="header mobile flex flex-row justify-between gap-2">
    <a href="/" class="logo flex justify-start items-center">
        <img class="site-logo" src="/img/logo.png" alt="Logo">
    </a>

    <div class="navigation flex flex-row items-center justify-end gap-2 h-full">
        <% if(user) { %>
            <div class="flex flex-row items-center gap-3 relative h-full">
                <% if(page == 'casino' && app.paths.length > 2){ %>
                    <div class="balance flex flex-row items-center justify-center gap-2 pointer" style="background: linear-gradient(135deg, rgba(15, 23, 42, 0.95) 0%, rgba(30, 41, 59, 0.95) 100%); border: 1px solid rgba(6, 182, 212, 0.3); border-radius: 9999px; padding: 6px 12px;">
                        <div class="coin main"></div>
                        <span class="amount" style="font-size: 14px; font-weight: 700;">In play</span>
                    </div>
                <% } else { %>
                    <div class="balance flex flex-row items-center justify-center gap-2 pointer" data-type="total" style="background: linear-gradient(135deg, rgba(15, 23, 42, 0.95) 0%, rgba(30, 41, 59, 0.95) 100%); border: 1px solid rgba(6, 182, 212, 0.3); border-radius: 9999px; padding: 6px 12px;">
                        <div class="coin main"></div>
                        <span class="amount">0.00</span>
                        <span class="balance-currency" style="color: rgba(203, 213, 225, 0.8);">SOL</span>
                        <i class="fa fa-angle-down" aria-hidden="true" style="color: rgba(6, 182, 212, 0.7); font-size: 12px;"></i>
                    </div>
                <% } %>

                <!-- Mobile User Menu -->
                <div class="navbar-user-wrapper relative">
                    <div class="navbar-user-pill pointer" id="user-menu-toggle-mobile">
                        <div class="flex flex-row items-center justify-center gap-2">
                            <img src="<%= user.avatar %>" alt="<%= user.name %>" class="navbar-user-avatar" style="width: 28px; height: 28px; border-radius: 50%; object-fit: cover;">
                            <i class="fa fa-angle-down" aria-hidden="true" style="font-size: 10px;"></i>
                        </div>
                        
                        <!-- User Dropdown Menu -->
                        <div class="navbar-user-dropdown list flex flex-col transition duration-200 hidden" id="user-menu-dropdown-mobile">
                            <a href="/account/settings" class="navbar-dropdown-item">
                                <i class="fa fa-cog" aria-hidden="true"></i>
                                <span>Settings</span>
                            </a>
                            <a href="/account/security" class="navbar-dropdown-item">
                                <i class="fa fa-shield" aria-hidden="true"></i>
                                <span>Security</span>
                            </a>
                            <a href="/account/games" class="navbar-dropdown-item">
                                <i class="fa fa-history" aria-hidden="true"></i>
                                <span>Games History</span>
                            </a>
                            <div class="navbar-dropdown-divider"></div>
                            <div class="navbar-dropdown-item text-danger pointer" data-modal="show" data-id="#modal_auth_logout">
                                <i class="fa fa-sign-out" aria-hidden="true"></i>
                                <span>Logout</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        <% } else { %>
            <a class="h-full" href="/login?returnUrl=/<%= app.paths.join('/') %>">
                <button type="button" class="button button-card shadow-2 h-full flex justify-center items-center">Sign In</button>
            </a>
        <% } %>

        <button class="button pullout_view" data-pullout="menu"><i class="fa fa-bars" aria-hidden="true"></i></button>
        <button class="button pullout_view" data-pullout="chat"><i class="fa fa-times" aria-hidden="true"></i></button>
    </div>
</div>

<script>
// User menu dropdown toggle (desktop and mobile)
(function() {
    function setupUserMenu(toggleId, dropdownId) {
        var userMenuToggle = document.getElementById(toggleId);
        var userMenuDropdown = document.getElementById(dropdownId);
        
        if (userMenuToggle && userMenuDropdown) {
            userMenuToggle.addEventListener('click', function(e) {
                e.stopPropagation();
                userMenuDropdown.classList.toggle('hidden');
            });
            
            // Close dropdown when clicking outside
            document.addEventListener('click', function(e) {
                if (!userMenuToggle.contains(e.target) && !userMenuDropdown.contains(e.target)) {
                    userMenuDropdown.classList.add('hidden');
                }
            });
            
            // Close dropdown when clicking on a menu item
            var menuItems = userMenuDropdown.querySelectorAll('.navbar-dropdown-item');
            menuItems.forEach(function(item) {
                item.addEventListener('click', function() {
                    // Don't close if it's the logout button (it opens a modal)
                    if (!item.hasAttribute('data-modal')) {
                        userMenuDropdown.classList.add('hidden');
                    }
                });
            });
        }
    }
    
    // Setup desktop menu
    setupUserMenu('user-menu-toggle', 'user-menu-dropdown');
    
    // Setup mobile menu
    setupUserMenu('user-menu-toggle-mobile', 'user-menu-dropdown-mobile');
})();
</script>